

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>volue.mesh.calc.transform &mdash; volue.mesh 0.0.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> volue.mesh
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Welcome</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../quickstart.html">Quickstart guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction_to_mesh.html">An introduction to Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usecases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../versions.html">Versions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SDK Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API documentation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">volue.mesh</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>volue.mesh.calc.transform</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for volue.mesh.calc.transform</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Mesh calculation transformation functions.</span>
<span class="sd">*******************************************</span>

<span class="sd">For more information see :ref:`mesh_functions:transform`.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="kn">from</span> <span class="nn">volue.mesh</span> <span class="kn">import</span> <span class="n">Timeseries</span>
<span class="kn">from</span> <span class="nn">volue.mesh.calc.common</span> <span class="kn">import</span> <span class="n">_Calculation</span><span class="p">,</span> <span class="n">Timezone</span><span class="p">,</span> <span class="n">_parse_single_timeseries_response</span>


<div class="viewcode-block" id="Method"><a class="viewcode-back" href="../../../../mesh_functions.html#volue.mesh.calc.transform.Method">[docs]</a><span class="k">class</span> <span class="nc">Method</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Methods used for transforming a time series from one resolution to another.</span>

<span class="sd">    Args:</span>
<span class="sd">        SUM: The sum of the values included in the base for this value. Does not consider how long the values are valid, i.e. a break point series with two values in the current interval that will give the sum of these two values.</span>
<span class="sd">        SUMI: Integral based sum with resolution second. Calculates the sum of value multiplied with number of seconds each value is valid. Value equal 1 at the start of the day will give 86400 as day value if the base is one break point series and 3600 if this is an hour series with only one value on first hour.</span>
<span class="sd">        AVG: For fixed interval series. Sum of all values in accumulation period divided by number of values in the accumulation period (24 for hour series that is transformed to day series). For break point series: Mean value of the values included in the base for this value. Does not consider how long the values are valid, i.e. a break point series with two values in the current interval that will give the mean value of these two values.</span>
<span class="sd">        AVGI: Integral based mean value, i.e. considers how much of the accumulation period that a given value is valid (to next value that can be NaN for a fixed interval series). This value is presented as mean value in the summary part of the presentation in Table.</span>
<span class="sd">        FIRST: First value in the accumulation period. For break point series this is the functional value at the start of the accumulation period, unless there exist an explicit value. Please note! For fixed interval series it is the first value not being NaN in the accumulation period.</span>
<span class="sd">        LAST: Last value in the accumulation period. For break point series this is the functional value at the end of the accumulation period, unless there exist an explicit value. Note! For fixed interval series it is the last value not being NaN in the accumulation period.</span>
<span class="sd">        MIN: Smallest value in the accumulation period.</span>
<span class="sd">        MAX: Largest value in the accumulation period.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SUM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SUMI</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># I -&gt; weighted sum, only for breakpoint timeseries</span>
    <span class="n">AVG</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># equivalent to MEAN</span>
    <span class="n">AVGI</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># I -&gt; weighted average, only for breakpoint timeseries</span>
    <span class="n">FIRST</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">LAST</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">MIN</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">MAX</span> <span class="o">=</span> <span class="mi">8</span></div>


<span class="k">class</span> <span class="nc">_TransformFunctionsBase</span><span class="p">(</span><span class="n">_Calculation</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for all tranformation function classes&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_transform_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">resolution</span><span class="p">:</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">Resolution</span><span class="p">,</span>
                              <span class="n">method</span><span class="p">:</span> <span class="n">Method</span><span class="p">,</span>
                              <span class="n">timezone</span><span class="p">:</span> <span class="n">Timezone</span><span class="p">,</span>
                              <span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an expression for `transform`.</span>

<span class="sd">        Args:</span>
<span class="sd">            resolution (:class:`volue.mesh.Timeseries.Resolution`): the resolution to transform to</span>
<span class="sd">            method (Method): what method to use for the transformation</span>
<span class="sd">            timezone (Timezone): timezone</span>
<span class="sd">            search_query (str): a search formulated using the :doc:`Mesh search language &lt;mesh_search&gt;`</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: a `transformation` expression</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">Resolution</span><span class="o">.</span><span class="n">BREAKPOINT</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;BREAKPOINT&#39; resolution is unsupported for timeseries transformation&quot;</span><span class="p">)</span>

        <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;## = @TRANSFORM(@t(&quot;</span>
        <span class="k">if</span> <span class="n">search_query</span><span class="p">:</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">expression</span><span class="si">}</span><span class="s2">&#39;</span><span class="si">{</span><span class="n">search_query</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">expression</span><span class="si">}</span><span class="s2">), &#39;</span><span class="si">{</span><span class="n">resolution</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, &#39;</span><span class="si">{</span><span class="n">method</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

        <span class="k">if</span> <span class="n">timezone</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">expression</span><span class="si">}</span><span class="s2">, &#39;</span><span class="si">{</span><span class="n">timezone</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">expression</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">expression</span>

    <span class="c1"># Interface</span>
    <span class="c1"># abstractmethod does not take into account if method is async or not</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">resolution</span><span class="p">:</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">Resolution</span><span class="p">,</span>
                  <span class="n">method</span><span class="p">:</span> <span class="n">Method</span><span class="p">,</span>
                  <span class="n">timezone</span><span class="p">:</span> <span class="n">Timezone</span> <span class="o">=</span> <span class="n">Timezone</span><span class="o">.</span><span class="n">UTC</span><span class="p">,</span>
                  <span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms time series from one resolution to another resolution.</span>

<span class="sd">        Some of target resolutions have a time zone foundation.</span>
<span class="sd">        Note: the `LOCAL` and `STANDARD` time zone refers to time zone of Mesh server, not the Python client.</span>

<span class="sd">        Example:</span>
<span class="sd">             `DAY` can be related to European Standard Time (UTC+1), which is different from the DAY scope in Finland (UTC+2).</span>
<span class="sd">             When the time zone argument to TRANSFORM is omitted, the configured standard time zone with no Daylight Saving Time enabled is used.</span>
<span class="sd">            You can use it to convert both ways, i.e. both from finer to coarser resolution, and the other way.</span>
<span class="sd">            The most common use is accumulation, i.e. transformation to coarser resolution.</span>
<span class="sd">            Most transformation methods are available for this latter use.</span>

<span class="sd">        Args:</span>
<span class="sd">            resolution (:class:`volue.mesh.Timeseries.Resolution`): the resolution to transform to</span>
<span class="sd">            method (Method): what method to use for the transformation</span>
<span class="sd">            timezone (Timezone): timezone</span>
<span class="sd">            search_query (str): a search formulated using the :doc:`Mesh search language &lt;mesh_search&gt;`</span>

<span class="sd">        Note:</span>
<span class="sd">            The resulting objects from the `search_query` will be used in the `transform` function, if `search_query` is not set the `relative_to` object will be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`volue.mesh.Timeseries`: a time series.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="TransformFunctions"><a class="viewcode-back" href="../../../../mesh_functions.html#volue.mesh.calc.transform.TransformFunctions">[docs]</a><span class="k">class</span> <span class="nc">TransformFunctions</span><span class="p">(</span><span class="n">_TransformFunctionsBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for transformation functions that should be run synchronously&quot;&quot;&quot;</span>
<div class="viewcode-block" id="TransformFunctions.transform"><a class="viewcode-back" href="../../../../mesh_functions.html#volue.mesh.calc.transform.TransformFunctions.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">resolution</span><span class="p">:</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">Resolution</span><span class="p">,</span>
                  <span class="n">method</span><span class="p">:</span> <span class="n">Method</span><span class="p">,</span>
                  <span class="n">timezone</span><span class="p">:</span> <span class="n">Timezone</span> <span class="o">=</span> <span class="n">Timezone</span><span class="o">.</span><span class="n">UTC</span><span class="p">,</span>
                  <span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_transform_expression</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">search_query</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_parse_single_timeseries_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TransformFunctionsAsync"><a class="viewcode-back" href="../../../../mesh_functions.html#volue.mesh.calc.transform.TransformFunctionsAsync">[docs]</a><span class="k">class</span> <span class="nc">TransformFunctionsAsync</span><span class="p">(</span><span class="n">_TransformFunctionsBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for transformation functions that should be run asynchronously&quot;&quot;&quot;</span>
<div class="viewcode-block" id="TransformFunctionsAsync.transform"><a class="viewcode-back" href="../../../../mesh_functions.html#volue.mesh.calc.transform.TransformFunctionsAsync.transform">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">resolution</span><span class="p">:</span> <span class="n">Timeseries</span><span class="o">.</span><span class="n">Resolution</span><span class="p">,</span>
                        <span class="n">method</span><span class="p">:</span> <span class="n">Method</span><span class="p">,</span>
                        <span class="n">timezone</span><span class="p">:</span> <span class="n">Timezone</span> <span class="o">=</span> <span class="n">Timezone</span><span class="o">.</span><span class="n">UTC</span><span class="p">,</span>
                        <span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Timeseries</span><span class="p">:</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_transform_expression</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">search_query</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_parse_single_timeseries_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Volue AS.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>